language: android

jdk: oraclejdk8

rvm:
- 2.3.4

before_install:
  #get Android NDK
- wget https://dl.google.com/android/repository/android-ndk-r12b-linux-x86_64.zip -O $HOME/ndk.zip
- unzip -q $HOME/ndk.zip -d $HOME
- export ANDROID_NDK_HOME=$HOME/android-ndk-r12b
- rm $HOME/ndk.zip
- wget https://s3.amazonaws.com/files.tau-technologies.com/buildenv/addon-symbol-emdk_v4.2-API-22.zip -O $HOME/emdk.zip
- unzip -q $HOME/emdk.zip -d $ANDROID_HOME/add-ons
#genearate keystore
- cd $HOME/.android && printf "123456\n123456\nTRAVIS-CI\nCI-SYSTEM\nTAU\nUNIVERSE\nUNIVERSE\nUN\nyes\n\n" | keytool -genkey -v -keystore ci-key.keystore -alias ci-key-alias -keyalg RSA -keysize 2048 -validity 10000

install:
- gem install rest-client listen zip

script:
- rake gem
- rvm install 2.3.4
- rvm use 2.3.4
- rvm gemset create rhodes
- rvm gemset use rhodes
- travis_wait 30 gem install ./rhodes-$(cat ./version).gem --no-document
- printf "$JAVA_HOME\n$ANDROID_HOME\n$ANDROID_NDK_HOME\n\n\n\n\n\n\n" | rhodes-setup
- git clone https://github.com/rhomobile/RMS-Testing.git $HOME/RMS-Testing
- cd $HOME/RMS-Testing/auto/feature_def/auto_common_spec && rake run:android > $HOME/build.log

android:
  components:
    - tools
    - platform-tools
    - extra-google-google_play_services
    - extra-google-m2repository
    - extra-android-m2repository
    - sys-img-x86-android-19
    - addon-google_apis_x86-google-19
