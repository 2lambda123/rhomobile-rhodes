<form title="Edit Ticket" 
class="panel"
	  id="ticket_edit_form" 
	  method="POST" 
	  action="<%=url_for('update')%>">
		
		<h1 style="margin:0px"><%= @ticket.title %></h1>

		<div class="ticket_header">
			#<%= @ticket.number %> <%= Project.find(@ticket.project_id).name %>
			<div class="font-size:85%"><span>Reported by:</span> 
			<a href="<%= "/Lighthouse/User/{#{@ticket.creator_id}}/show" %>"><%= User.find(@ticket.creator_id).name %></a> | <%= @ticket.created_at %></div>
		</div>
		<div id="ticket_history">
			<% TicketVersions.find(:all).reject {|version| version.ticket_id != strip_braces(@ticket.object) }.each do |change| %>
				<span><%= User.find(change.user_id).name %> <%= change.updated_at %></span>
				<% change_log = change.changes.split("||||") # we encoded array on the server this way %>
				<% if change_log.length > 1 %>
					<ul>
						<% change_log.each do |element| %>
						<li><%= element %></li>
						<% end %>
					</ul>
				<% else %>
					<p><%= change.changes %></p>
				<% end %>
			<% end %>
		</div>
		<h2>UPDATE THIS TICKET</h2>
	<fieldset>
		<input type="hidden" name="id" value="<%=@ticket.object%>"/>
		
		  <div class="row">
			  <label>Edit Title</label>
			  <input type="text" name="ticket[title]" value="<%= @ticket.title %>"/>
		  </div>
		
		  <div class="row">
			  <label>Add a comment</label>
			  <input type="text" name="ticket[body]" value="<%= @ticket.body %>"/>
		  </div>
		
		  <div class="row">
			  <label>Tags</label>
			  <input type="text" name="ticket[tag]" value="<%= @ticket.tag %>"/>
		  </div>
		
			<div class="row"><label>Who's responsible?</label>
				<select id="ticket_assigned_user_id" name="ticket[assigned_user_id]">
					<option value="">-- none --</option>
					<% User.find(:all).each do |user| %>
						<% selected = (@ticket.assigned_user_id == strip_braces(user.object)) ? "selected=\"#{strip_braces(user.object)}\"" : "" %>
						<option value="<%= strip_braces(user.object) %>" <%= selected %>><%= user.name %></option>
					<% end %>
				</select>
		  </div>
		
		  <div class="row">
			  <label>Status</label>
			
				<select id="ticket_state" name="ticket[state]">
					<% %w(new open resolved hold invalid).each do |state| %>
						<% selected = (state == @ticket.state) ? "selected=\"#{@ticket.state}\"" : "" %>
						<option <%= selected %>><%= state %></option>
					<% end %>
				</select>
		  </div>
				
	</fieldset>
	<input type="submit" value="Update"/>
	<p align="center" class="whiteButton">
		<a href="<%=url_for('delete', @ticket.object)%>"><font color="#990000">Delete</font></a>
	</p>
</form>
