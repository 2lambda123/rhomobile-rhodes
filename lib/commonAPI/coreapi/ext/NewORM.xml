<?xml version = "1.0"?>
<?xml-stylesheet type="text/xsl" href="pb_help.xsl"?>
<API>
    <MODULE name="NewORM" parent="Rho" docNameOverride="ORM">
        <HELP_OVERVIEW>
## THIS IS BETA - Not production ready!

New implementation of the Rho.ORM module as a CoreAPI Common API module.  This will eventually replace the existing Rho.ORM module.
        </HELP_OVERVIEW>
        <MORE_HELP>
## Enabling the API           
This API is part of the `coreapi` extension that is included automatically.
    :::ruby
    extensions: ["coreapi"]

Next, since this is a beta version of the ORMModel module, to use it you will need to set a flag in `rhoconfig.txt`:

    use_new_orm = 1

## JavaScript Usage
Be sure to review the [JavaScript API Usage](/guide/api_js) guide for important information about using this API in JavaScript

## Ruby Usage
Be sure to review the [Ruby API Usage](/guide/api_ruby) guide for important information about using this API in Ruby

</MORE_HELP>

        <METHODS>

            <METHOD name="useNewOrm" access="STATIC">
                <DESC>Returns `true` if NewORM is enabled in rhoconfig.txt</DESC>
                <RETURN type="BOOLEAN"/>
            </METHOD>

            <METHOD name="getClientId" access="STATIC">
                <DESC>Returns the current RhoConnect client id.</DESC>
                <RETURN type="STRING"/>
            </METHOD>

            <METHOD name="haveLocalChanges" access="STATIC">
                <DESC>Returns `true` whenever there are any local (non-synced) changes across all sync-enabled models</DESC>
                <RETURN type="BOOLEAN"/>
            </METHOD>

            <METHOD name="databaseFullResetAndLogout" access="STATIC">
                <DESC>Deletes all records from the property bag and fixed_schema tables.  Logout the user from RhoConnect client.</DESC>
            </METHOD>

            <METHOD name="databaseLocalReset" access="STATIC">
                <DESC>Resets local database (sync-enabled models are not touched).</DESC>
            </METHOD>

            <METHOD name="databaseFullclientResetAndLogout" access="STATIC">
                <DESC>Deletes all records from the property bag and fixed_schema tables.  Logout the user from RhoConnect client and erases all RhoConnect client device information. Equivalent to `Rho.ORM.databaseFullReset(true)` followed by 
                `Rho.RhoConnectClient.logout()`.</DESC>
            </METHOD>

            <METHOD name="databaseClientReset" access="STATIC">
                <PARAMS>
                    <PARAM name="resetLocalModels" type="BOOLEAN" default="true">
                        <DESC>Whether or not to reset local models</DESC>
                    </PARAM>
                </PARAMS>
                <DESC>Resets `client_info` and sync-enabled models (optionally, local models as well)</DESC>
            </METHOD>

            <METHOD name="databaseFullResetEx" access="STATIC">
                <DESC>Resets selected models, `client_info` table and local models.</DESC>
                <PARAMS>
                    <PARAM name="models" type="ARRAY">
                        <DESC>List of model names to reset</DESC>
                    </PARAM>
                    <PARAM name="resetClientInfo" type="BOOLEAN">
                        <DESC>Whether or not to reset the `client_info` table (resets RhoConnect session)</DESC>
                        <CAN_BE_NIL/>
                    </PARAM>
                    <PARAM name="resetLocalModels" type="BOOLEAN" default="false">
                        <DESC>Whether or not to reset local models (not sync-enabled)</DESC>
                        <CAN_BE_NIL/>
                    </PARAM>
                </PARAMS>
            </METHOD>

            <METHOD name="databaseFullReset" access="STATIC">
                <PARAMS>
                    <PARAM name="resetClientInfo" type="BOOLEAN" default="false">
                        <CAN_BE_NIL/>
                        <DESC>Whether or not to reset `client_info` table (resets RhoConnect session)</DESC>
                    </PARAM>
                    <PARAM name="resetLocalModels" type="BOOLEAN" default="true">
                        <CAN_BE_NIL/>
                        <DESC>Whether or not to reset local models (not sync-enabled)</DESC>
                    </PARAM>
                </PARAMS>
                <DESC>Resets ALL models, `client_info` table and local models</DESC>
            </METHOD>

            <METHOD name="generateId" access="STATIC" generateDoc="false">
                <DESC>Returns a new unique object id</DESC>
                <RETURN type="INTEGER"/>    
            </METHOD>

            <METHOD name="getModel" generateAPI="false" access="STATIC">
                <APPLIES jsOnly="true"/>
                <PARAMS>
                    <PARAM name="modelName" type="STRING">
                        <DESC>Name of the model you want returned.</DESC>
                    </PARAM>
                </PARAMS>
                <RETURN type="Model"></RETURN>
            </METHOD>
            <METHOD name="addModel" generateAPI="false" access="STATIC">
                <DESC>Creates an ORM model reference.</DESC>
                <APPLIES jsOnly="true"/>
                <PARAMS>
                    <PARAM name='modelName' type='STRING'>
                        <DESC>The name of your model.</DESC>
                    </PARAM>
                    <PARAM name="Anoynomous Function" type="">
                        <DESC>Use this function to define a model.  Refer to the [ORMModel docs](NewORMModel) for examples.</DESC>
                    </PARAM>
                </PARAMS>
                <RETURN type="Model"/>
            </METHOD>

        </METHODS>
        
        <USER_OVERVIEW>
        </USER_OVERVIEW>

        <VER_INTRODUCED>4.1.0</VER_INTRODUCED>
        <PLATFORM>
        </PLATFORM>
    </MODULE>
</API>    
