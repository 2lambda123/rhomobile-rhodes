<?xml version='1.0' encoding='UTF-8'?> 
<manifest xmlns:android='http://schemas.android.com/apk/res/android'
          package='<%= @appPackageName %>'
          android:versionName='<%= @versionName %>'
          android:versionCode='<%= @versionCode %>'
          android:installLocation='<%= @installLocation %>'>

  <!-- Android SDK -->
  <uses-sdk android:minSdkVersion='<%= @minSdkVer %>' android:targetSdkVersion='<%= @targetSdkVer %>'
    <% if @maxSdkVer %>
      android:maxSdkVersion='<%= @maxSdkVer %>'
    <% end %>
  />
  
  <!-- Permission declarations -->
  <% @permissions.each do |name, protectionLevel| %>
  <permission android:name='<%=name%>' android:protectionLevel='<%=protectionLevel%>'/>
  <% end %>
  
  <!-- Uses permissions -->
  <% @usesPermissions.each do |name| %>
  <uses-permission android:name='<%=name%>'/>
  <% end %>



  <%# FOR KIOSK %>

  <uses-permission android:name="android.permission.READ_PHONE_STATE" />
  <uses-permission android:name="android.permission.ANSWER_PHONE_CALLS" />
  <uses-permission android:name="android.permission.CALL_PHONE" />

  <uses-permission android:name="android.permission.DISABLE_KEYGUARD" />
  <uses-permission android:name="android.permission.KILL_BACKGROUND_PROCESSES" />
  <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
  <uses-permission
      android:name="android.permission.PACKAGE_USAGE_STATS" />




  <supports-screens android:smallScreens='true' android:normalScreens='true' android:largeScreens='true' android:xlargeScreens='true'/>
  <application android:name='com.rhomobile.rhodes.RhodesApplication'
  <% if canRenderNetworkSecurityConfig %>
               android:networkSecurityConfig="@xml/network_security_config"
  <% end %>
               android:label='@string/app_name'
               android:icon='@mipmap/icon'
               android:debuggable='<%= @debuggable %>'
               android:allowBackup='<%= @allowBackup %>'>

    <!-- Uses libraries -->
    <% @usesLibraries.each do |name, isrequired| %>
    <uses-library android:name='<%=name%>'
    <% unless isrequired %>
      android:required='<%=isrequired%>'
    <% end %>
    />
    <% end %>

    <!-- Main activity -->
    <activity android:name='com.rhomobile.rhodes.RhodesActivity'
              android:label='@string/app_name'
              android:launchMode='singleTask'
              android:configChanges='orientation|screenSize|fontScale|smallestScreenSize|keyboard|keyboardHidden'
              android:screenOrientation='<%= @screenOrientation %>'
              android:exported='true'
              <% if @hardwareAcceleration %>
              android:hardwareAccelerated='true'
              <% end %> >
      <% @rhodesActivityIntentFilters.each do |filter| %>
        <%= makeIntentFilter(filter) %>
      <% end %>

    </activity>
    <activity android:name='com.rhomobile.rhodes.alert.PopupActivity' android:windowSoftInputMode='stateAlwaysHidden' android:theme='@style/PopupTheme' android:configChanges='orientation' android:screenOrientation='<%= @screenOrientation %>'/>
    <activity android:name='com.rhomobile.rhodes.ui.FileList' android:configChanges='orientation' android:screenOrientation='<%= @screenOrientation %>'/>
    <activity android:name='com.rhomobile.rhodes.camera.ImageCapture' android:windowSoftInputMode='stateAlwaysHidden' android:screenOrientation='landscape'/>
    <activity android:name='com.rhomobile.rhodes.datetime.DateTimePickerScreen' android:windowSoftInputMode='stateAlwaysHidden' android:configChanges='orientation' android:screenOrientation='<%= @screenOrientation %>'/>
    <activity android:name='com.rhomobile.rhodes.mapview.MapView' android:windowSoftInputMode='stateAlwaysHidden' android:configChanges='orientation' android:screenOrientation='<%= @screenOrientation %>'/>
    <activity android:name='com.rhomobile.rhodes.ui.LogViewDialog'  android:windowSoftInputMode='stateAlwaysHidden' android:configChanges='orientation' android:screenOrientation='<%= @screenOrientation %>'/>
    <service android:name='com.rhomobile.rhodes.RhodesService' android:exported='false'/>

  <%# FOR KIOSK %>
     <service
        android:name="com.rhomobile.rhodes.kioskservices.MyAccessibilityService"
        android:description="@string/app_name"
        android:label="@string/app_name"
        android:exported="true"
        android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE"
        android:priority="1000">
        <intent-filter>
            <action android:name="android.accessibilityservice.AccessibilityService" />
        </intent-filter>
        <meta-data
            android:name="android.accessibilityservice"
            android:resource="@xml/accessibility_service_config" />
      </service>


      <receiver
            android:name="com.rhomobile.rhodes.kioskservices.CallReceiver"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.PHONE_STATE"/>
            </intent-filter>
        </receiver>

        <service
            android:name="com.rhomobile.rhodes.kioskservices.MyOverlayService"
            android:exported="false"/>

        <service
            android:name="com.rhomobile.rhodes.kioskservices.MyNotificationListenerService"
            android:label="@string/app_name"
            android:exported="true"
            android:permission="android.permission.BIND_NOTIFICATION_LISTENER_SERVICE">
            <intent-filter>
                <action android:name="android.service.notification.NotificationListenerService"/>
            </intent-filter>
        </service>


    <provider android:name='com.rhomobile.rhodes.LocalFileProvider' android:authorities='<%=@appPackageName%>' android:grantUriPermissions='false' <%= @androidVerMaj >= 7 ? "android:exported='true'" : "android:exported='false'" %> >
      <grant-uri-permission android:pathPrefix='/rhodes/apps/'/>
      <grant-uri-permission android:pathPrefix='/rhodata/apps/'/>
    </provider>

	<receiver android:name='com.rho.notification.AlarmReceiver' android:enabled="false" android:exported='true'>
     <intent-filter>
        <action android:name="android.intent.action.BOOT_COMPLETED" />
     </intent-filter>
    </receiver>

    <!-- application tag addon templates from extensions -->
    <% @applicationManifestAdds.each do |extAdd| %>
      <%=render extAdd%>
    <% end %>

  </application>

  <!-- manifest tag addon templates from extensions-->
  <% @manifestManifestAdds.each do |extAdd| %>
    <%=render extAdd%>
  <% end %>

</manifest>
