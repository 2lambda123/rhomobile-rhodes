#!/usr/bin/env ruby

rubyroot = File.expand_path( File.join( File.dirname(__FILE__),"../res/build-tools/ruby-standalone/212/usr/local" ) )
bindir = File.join( rubyroot, "bin" )
libdir = File.join( rubyroot, "lib/ruby/2.1.0" )
nativelibdir = File.join( libdir, "x86_64-darwin13.0" )
gemsdir = File.join( rubyroot,'lib','ruby','gems','2.1.0')

rhodesbin = File.join( File.dirname(__FILE__), "rhodes" )

args = ''
ARGV.each { |arg|
  args += arg + ' '
}
args.chomp

rhodes_commands = [
  'api',
  'api_test',
  'app',
  'extension',
  'iphone_project',
  'iphone_project_prebuild',
  'model',
  'spec'
]

executable = (ARGV.length==0 or rhodes_commands.include?(ARGV[0])) ? rhodesbin : 'rake'

cmdline = "#{executable} #{args}"

env =
  {
    "PATH" => "#{bindir}:#{ENV['PATH']}",
    "RUBYLIB" => "#{libdir}:#{nativelibdir}",
    "GEM_PATH" => gemsdir,
    "GEM_HOME" => gemsdir
  }

exec( env, cmdline )